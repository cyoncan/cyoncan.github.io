<html><head><title>Dns_Server-Bind</title><meta name="keywords" content="linux"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link href="/css/main.css?v=3" rel="stylesheet" type="text/css"><script src="/js/util.js"></script><script>isMobile()?loadjscssfile("../css/mobile.css","css"):loadjscssfile("../css/desktop.css","css")</script><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"></head><body><h2 class="title">Dns_Server-Bind</h2><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-安装"><span class="toc-text">1.安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-修改配置文件"><span class="toc-text">2.修改配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-自定义域名解析配置"><span class="toc-text">3.自定义域名解析配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-自定义test88-tt-zone和1-168-192-arpa文件"><span class="toc-text">4.自定义test88.tt.zone和1.168.192.arpa文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-修改DNS配置"><span class="toc-text">5.修改DNS配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-修改客户端机器的DNS为192-168-2-100"><span class="toc-text">6.修改客户端机器的DNS为192.168.2.100</span></a></li></ol><a id="more"></a><p><strong>需求：公司地址迁移，原来内部测试服务器用的是某百兆企业路由器做的DNS重定向。新地址用的是五百兆宽带，弃用了原来的路由器，换了新的千兆，但是没有DNS重定向功能，于是就在测试服务器本身搭建DNS服务，提供内网自定义域名解析。</strong></p><p>系统： centos6.8</p><p>ip地址：192.168.1.100</p><p>dns软件：bind</p><p>域名：test88.tt</p><h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum install <span class="built_in">bind</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install <span class="built_in">bind</span>-chroot</span></span><br></pre></td></tr></table></figure><h3 id="2-修改配置文件"><a href="#2-修改配置文件" class="headerlink" title="2.修改配置文件"></a>2.修改配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cp /etc/named.conf /etc/named.conf.bak   <span class="comment">#先备份原配置文件</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/named.conf</span></span><br><span class="line">//</span><br><span class="line">// named.conf</span><br><span class="line">//</span><br><span class="line">// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS</span><br><span class="line">// server as a caching only nameserver (as a localhost DNS resolver only).</span><br><span class="line">//</span><br><span class="line">// See /usr/share/doc/bind*/sample/ for example named configuration files.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">options &#123;</span><br><span class="line">	listen-on port 53 &#123; any; &#125;;   //53为dns监听端口，any代表监听所以主机。</span><br><span class="line">	listen-on-v6 port 53 &#123; ::1; &#125;;   //属于ipv6</span><br><span class="line">	directory 	"/var/named";   </span><br><span class="line">	dump-file 	"/var/named/data/cache_dump.db";</span><br><span class="line">        statistics-file "/var/named/data/named_stats.txt";</span><br><span class="line">        memstatistics-file "/var/named/data/named_mem_stats.txt";</span><br><span class="line">	allow-query     &#123; any; &#125;;   //对DNS服务器提出查询请求。any代表任何人</span><br><span class="line">	recursion yes;</span><br><span class="line"></span><br><span class="line">	dnssec-enable yes;</span><br><span class="line">	dnssec-validation yes;</span><br><span class="line"></span><br><span class="line">	/* Path to ISC DLV key */</span><br><span class="line">	bindkeys-file "/etc/named.iscdlv.key";</span><br><span class="line"></span><br><span class="line">	managed-keys-directory "/var/named/dynamic";</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">logging &#123;</span><br><span class="line">        channel default_debug &#123;</span><br><span class="line">                file "data/named.run";</span><br><span class="line">                severity dynamic;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone "." IN &#123;</span><br><span class="line">	type hint;</span><br><span class="line">	file "named.ca";</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">include "/etc/named.rfc1912.zones";</span><br><span class="line">include "/etc/named.root.key";</span><br></pre></td></tr></table></figure><h3 id="3-自定义域名解析配置"><a href="#3-自定义域名解析配置" class="headerlink" title="3.自定义域名解析配置"></a>3.自定义域名解析配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/named.rfc1912.zones   //添加域</span></span><br><span class="line">//正向域</span><br><span class="line">zone "test88.tt" IN &#123;</span><br><span class="line">	type master;</span><br><span class="line">	file "test88.tt.zone";</span><br><span class="line">	allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">//反向域</span><br><span class="line">zone "1.168.192.in-addr.arpa" IN &#123;</span><br><span class="line">	type master;</span><br><span class="line">	file "1.168.192.arpa";</span><br><span class="line">	allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="4-自定义test88-tt-zone和1-168-192-arpa文件"><a href="#4-自定义test88-tt-zone和1-168-192-arpa文件" class="headerlink" title="4.自定义test88.tt.zone和1.168.192.arpa文件"></a>4.自定义test88.tt.zone和1.168.192.arpa文件</h3><p>test88.tt.zone</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /var/named/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp -a named.localhost test88.tt.zone</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim test88.tt.zone</span></span><br><span class="line"><span class="meta">$</span><span class="bash">TTL 86400</span></span><br><span class="line">@	IN SOA		ns.test88.tt. rname.invalid. (</span><br><span class="line">					0	; serial</span><br><span class="line">					1D	; refresh</span><br><span class="line">					1H	; retry</span><br><span class="line">					1W	; expire</span><br><span class="line">					3H )	; minimum</span><br><span class="line">@	IN	NS	ns.test88.tt.</span><br><span class="line">ns	IN	A	192.168.2.100</span><br><span class="line">www	IN	A	192.168.2.100</span><br><span class="line">mail	IN  A	192.168.2.115</span><br><span class="line">zentao	IN	A	192.168.2.100</span><br><span class="line">wiki	IN	A	192.168.2.100</span><br></pre></td></tr></table></figure><p>1.168.192.arpa</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">TTL 86400</span></span><br><span class="line">@	IN SOA	test88.tt. rname.invalid. (</span><br><span class="line">					0	; serial</span><br><span class="line">					1D	; refresh</span><br><span class="line">					1H	; retry</span><br><span class="line">					1W	; expire</span><br><span class="line">					3H )	; minimum</span><br><span class="line">	IN 	NS	@</span><br><span class="line">	IN	A	127.0.0.1</span><br><span class="line">100	IN	PTR	www.test88.tt.</span><br><span class="line">100	IN	PTR	mail.test88.tt.</span><br><span class="line">100	IN	PTR	zentao.test88.tt.</span><br><span class="line">100	IN	PTR	wiki.test88.tt.</span><br></pre></td></tr></table></figure><h3 id="5-修改DNS配置"><a href="#5-修改DNS配置" class="headerlink" title="5.修改DNS配置"></a>5.修改DNS配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/resolv.conf</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by NetworkManager</span></span><br><span class="line">nameserver 192.168.2.100</span><br><span class="line">nameserver 192.168.2.1</span><br><span class="line"><span class="meta">$</span><span class="bash"> service named start</span></span><br></pre></td></tr></table></figure><h3 id="6-修改客户端机器的DNS为192-168-2-100"><a href="#6-修改客户端机器的DNS为192-168-2-100" class="headerlink" title="6.修改客户端机器的DNS为192.168.2.100"></a>6.修改客户端机器的DNS为192.168.2.100</h3><p><em>服务器防火墙开放53端口udp和tcp均要，关闭selinux。</em></p><div style="display:none"><script src="http://s4.cnzz.com/stat.php?id=&web_id=" language="JavaScript"></script>script></div></body></html>