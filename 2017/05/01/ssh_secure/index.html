<html><head><title>ssh安全</title><meta name="keywords" content="linux"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link href="/css/main.css?v=3" rel="stylesheet" type="text/css"><script src="/js/util.js"></script><script>isMobile()?loadjscssfile("../css/mobile.css","css"):loadjscssfile("../css/desktop.css","css")</script><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"></head><body><h2 class="title">ssh安全</h2><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#ssh安全配置优化"><span class="toc-text">ssh安全配置优化:</span></a></li></ol><a id="more"></a><h3 id="ssh安全配置优化"><a href="#ssh安全配置优化" class="headerlink" title="ssh安全配置优化:"></a>ssh安全配置优化:</h3><p><strong>1.修改ssh默认端口,改成非标准高端端口 (1024~65535)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sysctl -a | grep ip_local_port_range   (查看端口范围)</span><br><span class="line">net.ipv4.ip_local_port_range = 1024	65000</span><br><span class="line">$ vim /etc/syscofnig/iptables   (修改防火墙策略ssh 22为自定义端口)</span><br><span class="line">$ vim /etc/ssh/sshd_config   (修改ssh的端口为自定义端口)</span><br><span class="line">$ service sshd restart   (重启生效)</span><br></pre></td></tr></table></figure><p><strong>2.禁止直接用root登录ssh,设置用普通账户ssh,然后切换到root.</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/ssh/sshd_config</span></span><br><span class="line">PermitRootLogin no</span><br><span class="line"><span class="meta">$</span><span class="bash"> service iptables restart</span></span><br></pre></td></tr></table></figure><p><strong>3.指定ssh连接的ip地址</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/hosts.deny</span></span><br><span class="line">sshd:all:deny</span><br><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/hosts.allow</span></span><br><span class="line">sshd:192.168.2.10:allow</span><br></pre></td></tr></table></figure><p><strong>4.xshell使用public key登录ssh</strong></p><p>xshell工具&gt;新建用户密钥生成向导,生成一堆密钥,最好填写上加密密码.</p><p>把公钥传到服务器用户目录下面,可用ftp方式上传</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat id_rsa.pub &gt;&gt; authorized_keys   (将上传的公钥追加到authorized里面,没有该文件可以新建)</span><br></pre></td></tr></table></figure><p>这样就可以不用密码去登录了,注意不同的用户使用,都要分别去给不同用户目录下的~/.ssh追加我们xshell传过去的公钥.</p><p><strong>5.xshell使用Google身份验证器登录</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> setenforce 0   关闭SELinux</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install libpng libtool pam -y</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install qrencode -y</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/google/google-authenticator-libpam.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> google-authenticator-libpam</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./bootstrap.sh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./configure</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make install</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制google 身份验证器pam模块到系统下</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp /usr/<span class="built_in">local</span>/lib/security/pam_google_authenticator.so /lib64/security</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/pam.d/sshd</span></span><br><span class="line">auth required pam_google_authenticator.so no_increment_hotp</span><br><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/ssh/sshd_config</span></span><br><span class="line">ChallengeResponseAuthentication yes</span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl restart ssh.service</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> google-authenticator</span></span><br><span class="line">手机上去酷安或者google play上下载Google身份验证器,扫描生成的二维码.xshell登录选择keyboard</span><br></pre></td></tr></table></figure><div style="display:none"><script src="http://s4.cnzz.com/stat.php?id=&web_id=" language="JavaScript"></script>script></div></body></html>