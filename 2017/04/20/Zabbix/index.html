<html><head><title>Zabbix搭建</title><meta name="keywords" content="linux"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link href="/css/main.css?v=3" rel="stylesheet" type="text/css"><script src="/js/util.js"></script><script>isMobile()?loadjscssfile("../css/mobile.css","css"):loadjscssfile("../css/desktop.css","css")</script><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"></head><body><h2 class="title">Zabbix搭建</h2><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#zabbix搭建"><span class="toc-text">zabbix搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一-web环境安装参考另一篇写lnmp搭建的文章"><span class="toc-text">一.web环境安装参考另一篇写lnmp搭建的文章</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二-zabbix安装搭建"><span class="toc-text">二.zabbix安装搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#tip-在官方的文档上已经有很详细的说明-下面是根据自己的实际情况参照文档安装过程"><span class="toc-text">tip:在官方的文档上已经有很详细的说明,下面是根据自己的实际情况参照文档安装过程.</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-zabbix下载安装选LTS-我下的3-0最新的源码包"><span class="toc-text">1.zabbix下载安装选LTS,我下的3.0最新的源码包</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-创建zabbix数据库-导入数据库"><span class="toc-text">2.创建zabbix数据库,导入数据库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-修改zabbix-server配置文件"><span class="toc-text">3.修改zabbix_server配置文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-创建web目录"><span class="toc-text">4.创建web目录</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-配置nginx"><span class="toc-text">5.配置nginx</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-修改php-ini文件-这个地方债官网上有配置要求说明"><span class="toc-text">6.修改php.ini文件(这个地方债官网上有配置要求说明)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-启动-进入安装界面"><span class="toc-text">7.启动,进入安装界面</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-客户端安装"><span class="toc-text">8.客户端安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-客户端和服务端使用加密传输"><span class="toc-text">9.客户端和服务端使用加密传输</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#i-使用psk共享密钥加密"><span class="toc-text">i. 使用psk共享密钥加密</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ii-使用证书加密"><span class="toc-text">ii. 使用证书加密</span></a></li></ol></li></ol></li></ol><a id="more"></a><h1 id="zabbix搭建"><a href="#zabbix搭建" class="headerlink" title="zabbix搭建"></a>zabbix搭建</h1><blockquote><p>环境: centos6,lnmp,zabbix3.0.8</p></blockquote><h3 id="一-web环境安装参考另一篇写lnmp搭建的文章"><a href="#一-web环境安装参考另一篇写lnmp搭建的文章" class="headerlink" title="一.web环境安装参考另一篇写lnmp搭建的文章"></a>一.web环境安装参考另一篇写lnmp搭建的文章</h3><h3 id="二-zabbix安装搭建"><a href="#二-zabbix安装搭建" class="headerlink" title="二.zabbix安装搭建"></a>二.zabbix安装搭建</h3><h6 id="tip-在官方的文档上已经有很详细的说明-下面是根据自己的实际情况参照文档安装过程"><a href="#tip-在官方的文档上已经有很详细的说明-下面是根据自己的实际情况参照文档安装过程" class="headerlink" title="tip:在官方的文档上已经有很详细的说明,下面是根据自己的实际情况参照文档安装过程."></a>tip:在官方的文档上已经有很详细的说明,下面是根据自己的实际情况参照文档安装过程.</h6><h5 id="1-zabbix下载安装选LTS-我下的3-0最新的源码包"><a href="#1-zabbix下载安装选LTS-我下的3-0最新的源码包" class="headerlink" title="1.zabbix下载安装选LTS,我下的3.0最新的源码包"></a>1.zabbix下载安装选LTS,我下的3.0最新的源码包</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ wget -c https://nchc.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/3.0.8/zabbix-3.0.8.tar.gz</span><br><span class="line">$ tar zxvf zabbix-3.0.8.tar.gz</span><br><span class="line">$ groupadd zabbix</span><br><span class="line">$ useradd -g zabbix zabbix</span><br><span class="line">$ <span class="built_in">cd</span> zabbix-3.0.8/ </span><br><span class="line">$ ./configure --prefix=/data/<span class="built_in">local</span>/zabbix --<span class="built_in">enable</span>-server --<span class="built_in">enable</span>-agent --with-mysql --<span class="built_in">enable</span>-ipv6 --with-net-snmp --with-libcurl --with-libxml2 --with-openssl</span><br><span class="line">$ yum install net-snmp-devel.x86_64 -y (根据实际环境去安装提示缺少的东西,MySQL大部分是因为没有软连接到usr/bin)</span><br><span class="line">$ ln -s /data/<span class="built_in">local</span>/zabbix/sbin/* /usr/sbin/</span><br></pre></td></tr></table></figure><h5 id="2-创建zabbix数据库-导入数据库"><a href="#2-创建zabbix数据库-导入数据库" class="headerlink" title="2.创建zabbix数据库,导入数据库"></a>2.创建zabbix数据库,导入数据库</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -uroot -p</span><br><span class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@<span class="string">'localhost'</span> identified by <span class="string">'passwd'</span>;</span><br><span class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@<span class="string">'127.0.0.1'</span> identified by <span class="string">'passwd'</span>;</span><br><span class="line">或者直接用</span><br><span class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@<span class="string">'%'</span> identified by <span class="string">'passwd'</span>;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; quit;</span><br><span class="line">$ <span class="built_in">cd</span> /data/src/zabbix-3.0.8/database/mysql</span><br><span class="line">$ mysql -uzabbix -p zabbix &lt; schema.sql   导入zabbix数据库脚本</span><br><span class="line"><span class="comment"># stop here if you are creating database for Zabbix proxy</span></span><br><span class="line">$ mysql -uzabbix -p zabbix &lt; images.sql</span><br><span class="line">$ mysql -uzabbix -p zabbix &lt; data.sql</span><br><span class="line">导入数据库另一种方法:</span><br><span class="line">$ mysql -uzabbix -p</span><br><span class="line">mysql&gt; use zabbix;</span><br><span class="line">mysql&gt; <span class="built_in">source</span> /data/src/zabbix-3.0.8/database/mysql/schema.sql;</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h5 id="3-修改zabbix-server配置文件"><a href="#3-修改zabbix-server配置文件" class="headerlink" title="3.修改zabbix_server配置文件"></a>3.修改zabbix_server配置文件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DBName=zabbix       <span class="comment">#数据库名称</span></span><br><span class="line">DBUser=zabbix       <span class="comment">#数据库用户名</span></span><br><span class="line">DBPassword=123456   <span class="comment">#数据库密码</span></span><br><span class="line">ListenIP=127.0.0.1  <span class="comment">#数据库ip地址</span></span><br><span class="line">Timeout=4</span><br><span class="line">AlertScriptsPath=/data/<span class="built_in">local</span>/zabbix/share/zabbix/alertscripts</span><br><span class="line">ExternalScripts=/data/<span class="built_in">local</span>/zabbix/share/zabbix/externalscripts</span><br><span class="line">LogSlowQueries=3000</span><br></pre></td></tr></table></figure><h5 id="4-创建web目录"><a href="#4-创建web目录" class="headerlink" title="4.创建web目录"></a>4.创建web目录</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/web/zabbix.monitor.cn</span><br><span class="line">cp -a /data/src/zabbix-3.0.8/frontend/php/* /data/web/zabbix.monitor.cn/</span><br><span class="line">chown -R www:www zabbix.monitor.cn/</span><br></pre></td></tr></table></figure><h5 id="5-配置nginx"><a href="#5-配置nginx" class="headerlink" title="5.配置nginx"></a>5.配置nginx</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">vim /data/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">在server模块外http模块内加入一行</span><br><span class="line">include vhost/*.conf</span><br><span class="line">:wq</span><br><span class="line"><span class="built_in">cd</span> /data/<span class="built_in">local</span>/nginx/conf/vhost</span><br><span class="line">vim zabbix.conf</span><br><span class="line">server</span><br><span class="line">      &#123;</span><br><span class="line">      listen 80;</span><br><span class="line">      server_name 127.0.0.1;</span><br><span class="line">      index index.html index.php;</span><br><span class="line">      root  /data/web/zabbix.monitor.cn;</span><br><span class="line">      access_log  /data/logs/<span class="variable">$SERVER_NAME</span>.access.log main;</span><br><span class="line">	  error_log  /data/logs/<span class="variable">$SERVER_NAME</span>.<span class="built_in">log</span> error;</span><br><span class="line">      </span><br><span class="line">      location / &#123;</span><br><span class="line">      fastcgi_index   index.php;</span><br><span class="line">      fastcgi_pass    127.0.0.1:9000;</span><br><span class="line">      include         fastcgi_params;</span><br><span class="line">      fastcgi_param   SCRIPT_FILENAME    <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">      fastcgi_param   SCRIPT_NAME        <span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">	  &#125;</span><br><span class="line"></span><br><span class="line">	  <span class="keyword">if</span> (!-e <span class="variable">$request_filename</span>)&#123;</span><br><span class="line">	  		 rewrite ^/(.*)$ /index.php/<span class="variable">$1</span> last;</span><br><span class="line">	  &#125;</span><br><span class="line">                </span><br><span class="line">      location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|JPG|xml|json)$</span><br><span class="line">      &#123;</span><br><span class="line">      expires      30d;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      location ~ .*\.(js|css)?$</span><br><span class="line">      &#123;</span><br><span class="line">      expires      12h;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">#   access_log m.log  access;</span></span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><h5 id="6-修改php-ini文件-这个地方债官网上有配置要求说明"><a href="#6-修改php-ini文件-这个地方债官网上有配置要求说明" class="headerlink" title="6.修改php.ini文件(这个地方债官网上有配置要求说明)"></a>6.修改php.ini文件(这个地方债官网上有配置要求说明)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">post_max_size = 32M</span><br><span class="line">max_execution_time = 300</span><br><span class="line">max_input_time = 300</span><br><span class="line">date.timezone = Asia/Shanghai</span><br><span class="line">以下是我自己的进入zabbi安装检测各个配置参数和模块是否满足zabbix安装要求.如果忘记更改php.ini或者不知道改哪些的,可以进入到安装界面http://zabbix.monitor.cn/setup.php 根据检测结果,再去修改,每次修改可能需要重启nginx和php-fpm</span><br><span class="line">PHP version	5.6.30(我用的PHP版本)	5.4.0(zabbix3.0.8要求PHP最低的版本,下面的参数类似要求)	OK</span><br><span class="line">PHP option <span class="string">"memory_limit"</span>	128M	128M	OK</span><br><span class="line">PHP option <span class="string">"post_max_size"</span>	32M	16M	OK</span><br><span class="line">PHP option <span class="string">"upload_max_filesize"</span>	2M	2M	OK</span><br><span class="line">PHP option <span class="string">"max_execution_time"</span>	300	300	OK</span><br><span class="line">PHP option <span class="string">"max_input_time"</span>	300	300	OK</span><br><span class="line">PHP option <span class="string">"date.timezone"</span>	Asia/Shanghai		OK</span><br><span class="line">PHP databases support	MySQL/SQLite3 OK</span><br><span class="line">PHP bcmath	on		OK</span><br><span class="line">PHP mbstring	on		OK</span><br><span class="line">PHP option <span class="string">"mbstring.func_overload"</span>	off	off	OK</span><br><span class="line">PHP option <span class="string">"always_populate_raw_post_data"</span>	off	off	OK</span><br><span class="line">PHP sockets	on		OK</span><br><span class="line">PHP gd	2.1.0	2.0	OK</span><br><span class="line">PHP gd PNG support	on		OK</span><br><span class="line">PHP gd JPEG support	on		OK</span><br><span class="line">PHP gd FreeType support	on		OK</span><br><span class="line">PHP libxml	2.7.6	2.6.15	OK</span><br><span class="line">PHP xmlwriter	on		OK</span><br><span class="line">PHP xmlreader	on		OK</span><br><span class="line">PHP ctype	on		OK</span><br><span class="line">PHP session	on		OK</span><br><span class="line">PHP option <span class="string">"session.auto_start"</span>	off	off	OK</span><br><span class="line">PHP gettext	on		OK</span><br><span class="line">PHP option <span class="string">"arg_separator.output"</span>	&amp;	&amp;	OK</span><br></pre></td></tr></table></figure><h5 id="7-启动-进入安装界面"><a href="#7-启动-进入安装界面" class="headerlink" title="7.启动,进入安装界面"></a>7.启动,进入安装界面</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ service nginx start</span><br><span class="line">$ service php-fpm start</span><br><span class="line">$ zabbix_server   </span><br><span class="line">浏览器输入 http://zabbix.monitor.cn/setup.php 域名是之前nginx里面配置好的,或者不用域名用IP和别的端口,域名需要做host映射,或者内网路由器里面做虚拟映射.出现界面下一步,填上MySQL zabbix用户密码一致,下一步,看到绿色congratulation 就安装完成了.</span><br><span class="line">默认用户名和密码:admin,zabbix</span><br><span class="line">设置zabbix服务开机启动</span><br><span class="line">$ cp /data/src/zabbix/misc/init.d/fedora/core/* /etc/init.d/</span><br><span class="line">$ vim /etc/init.d/zabbix_server</span><br><span class="line">修改BASEDIR你zabbix安装路径</span><br><span class="line">chkconfig --add zabbix_server</span><br><span class="line">chkconfig --add zabbix_agentd</span><br><span class="line">chkconfig zabbix_server on</span><br><span class="line">chkconfig zabbix_agentd on</span><br></pre></td></tr></table></figure><h5 id="8-客户端安装"><a href="#8-客户端安装" class="headerlink" title="8.客户端安装"></a>8.客户端安装</h5><p>客户端根据实际情况去使用几种方案,一般机器少的,都是一台server端,几台agent端.方案可以参考:<a href="http://t.cn/RXPa0zV" target="_blank" rel="noopener">http://t.cn/RXPa0zV</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/zabbix --<span class="built_in">enable</span>-agent --with-openssl</span><br><span class="line">make install</span><br><span class="line">其它的设置和前面的安装配置一样,zabbix_agentd.conf </span><br><span class="line">Server=Serverip</span><br><span class="line">ServerActive=Serverip</span><br><span class="line">Hostname=自定义zabbix客户端hostname,不要和server端配置的hostname一样.</span><br><span class="line">tip:将10050,10051端口添加到防火墙,server端也是.agent端需要启动zabbix_agentd服务</span><br></pre></td></tr></table></figure><h5 id="9-客户端和服务端使用加密传输"><a href="#9-客户端和服务端使用加密传输" class="headerlink" title="9.客户端和服务端使用加密传输"></a>9.客户端和服务端使用加密传输</h5><h6 id="i-使用psk共享密钥加密"><a href="#i-使用psk共享密钥加密" class="headerlink" title="i. 使用psk共享密钥加密"></a>i. 使用psk共享密钥加密</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Generating PSK在客户端操作</span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/zabbix/</span><br><span class="line">$ openssl rand -hex 32 -out zabbix_agentd.psk</span><br><span class="line">$ chown zabbix:zabbix zabbix_agentd.psk</span><br><span class="line">$ vim /etc/zabbix_agentd.conf</span><br><span class="line">  TLSConnect=psk</span><br><span class="line">  TLSAccept=psk</span><br><span class="line">  TLSPSKFile=/home/zabbix/zabbix_agentd.psk</span><br><span class="line">  TLSPSKIdentity=PSK 001</span><br><span class="line"> service zabbix_agentd restart</span><br><span class="line"> 回到server机器,在host机器加密那里选择psk,填入信息.</span><br></pre></td></tr></table></figure><h6 id="ii-使用证书加密"><a href="#ii-使用证书加密" class="headerlink" title="ii. 使用证书加密"></a>ii. 使用证书加密</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /data/<span class="built_in">local</span>/zabbix/zabbix_crt</span><br><span class="line">$ <span class="built_in">cd</span> zabbix_crt/</span><br><span class="line"><span class="comment">#生成ca私钥</span></span><br><span class="line">$ openssl genrsa -aes256 -out ca.key 2048   需要输入给私钥加密的密码</span><br><span class="line"><span class="comment">#使用ca私钥建立ca证书</span></span><br><span class="line">$ openssl req -new -x509 -nodes -days 1000 -key ca.key -subj /CN=ServerIPorDomainName\ CA/OU=Development\ group/O=Zabbix\ SIA/DC=zabbix/DC=com &gt; ca.crt</span><br><span class="line"><span class="comment">#生成服务器csr证书请求文件</span></span><br><span class="line">$ openssl req -newkey rsa:2048 -days 1000 -nodes -keyout server.key -subj /CN=ServerIPorDomainName/OU=Development\ group/O=Zabbix\ SIA/DC=zabbix/DC=com &gt; server.csr</span><br><span class="line"><span class="comment">#使用ca证书与私钥签发服务器证书</span></span><br><span class="line">$ openssl x509 -req -<span class="keyword">in</span> server.csr -days 1000 -CA ca.crt -CAkey ca.key -set_serial 01 &gt; server.crt</span><br><span class="line"><span class="comment">#生成客户端csr证书请求文件</span></span><br><span class="line">$ openssl req -newkey rsa:2048 -days 1000 -nodes -keyout client.key -subj /CN=client/OU=Development\ group/O=Zabbix\ SIA/DC=zabbix/DC=com &gt; client.csr</span><br><span class="line"><span class="comment">#使用ca证书与私钥签发客户端证书</span></span><br><span class="line">$ openssl x509 -req -<span class="keyword">in</span> client.csr -days 1000 -CA ca.crt -CAkey ca.key -set_serial 01 &gt; client.crt</span><br><span class="line"></span><br><span class="line">服务端文件位置可以不改变,用scp命令将刚刚生成的客户端需要文件上传到客户端自定义的文件夹 /usr/<span class="built_in">local</span>/zabbix/zabbix_crt/</span><br><span class="line"></span><br><span class="line">服务端: ca.crt , server.crt , server.crt</span><br><span class="line">vim /data/<span class="built_in">local</span>/zabbix/etc/zabbix_server.conf</span><br><span class="line">TLSCAFile=/data/<span class="built_in">local</span>/zabbix/zabbix_crt/ca.crt</span><br><span class="line">TLSCertFile=/usr/<span class="built_in">local</span>/zabbix/zabbix_crt/server.crt</span><br><span class="line">TLSKeyFile=/usr/<span class="built_in">local</span>/zabbix/zabbix_crt/server.key</span><br><span class="line"></span><br><span class="line">客户端: ca.crt , client.crt , client.crt</span><br><span class="line">TLSConnect=cert</span><br><span class="line">TLSAccept=cert</span><br><span class="line">TLSCAFile=/usr/<span class="built_in">local</span>/zabbix/zabbix_crt/ca.crt</span><br><span class="line">TLSCertFile=/usr/<span class="built_in">local</span>/zabbix/zabbix_crt/client.crt</span><br><span class="line">TLSKeyFile=/usr/<span class="built_in">local</span>/zabbix/zabbix_crt/client.key</span><br><span class="line"></span><br><span class="line">进入webui configuration/hosts/打开相应的主机/双向都可以选certificate</span><br><span class="line">重启zabbix_server和zabbix_agent,再进去看cert是否变蓝色,有延迟几十秒.</span><br><span class="line">我记录的文档可能有些不全,希望大家遇到问题多分析日志,去网上搜索遇到的错误信息.</span><br></pre></td></tr></table></figure><div style="display:none"><script src="http://s4.cnzz.com/stat.php?id=&web_id=" language="JavaScript"></script>script></div></body></html>