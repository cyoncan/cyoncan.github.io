<html><head><title>tcp_bbr</title><meta name="keywords" content="linux"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link href="/css/main.css?v=3" rel="stylesheet" type="text/css"><script src="/js/util.js"></script><script>isMobile()?loadjscssfile("../css/mobile.css","css"):loadjscssfile("../css/desktop.css","css")</script><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"></head><body><h2 class="title">tcp_bbr</h2><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Debian8-Ubuntu"><span class="toc-text">Debian8/Ubuntu</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CentOS-7"><span class="toc-text">CentOS 7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开启BBR"><span class="toc-text">开启BBR</span></a></li></ol><a id="more"></a><p><strong>TCP BBR是Google开源的拥塞控制算法,在Linux4.11内核版本上已经进行使用,最低内核要求4.9</strong></p><h2 id="Debian8-Ubuntu"><a href="#Debian8-Ubuntu" class="headerlink" title="Debian8/Ubuntu"></a>Debian8/Ubuntu</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.12.1/linux-headers-4.12.1-041201-generic_4.12.1-041201.201707121132_amd64.deb</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> dpkg -i linux-headers-4.12.1-041201-generic_4.12.1-041201.201707121132_amd64.deb</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> update-grub</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> reboot</span></span><br></pre></td></tr></table></figure><h2 id="CentOS-7"><a href="#CentOS-7" class="headerlink" title="CentOS 7"></a>CentOS 7</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum --enablerepo=elrepo-kernel install kernel-ml -y</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rpm -qa | grep kernel</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rpm -ev    <span class="comment">#删除旧内核</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> egrep ^menuentry /etc/grub2.cfg | cut -f 2 -d \<span class="string">'</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> grub2-set-default 0  <span class="comment">#default 0表示第一个内核设置为默认运行, 选择最新内核就对了</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> reboot</span></span><br></pre></td></tr></table></figure><p>重新启动后，如果会出现“read-only file system” 的错误，root账户下执行mount -o remount rw / 即可</p><h2 id="开启BBR"><a href="#开启BBR" class="headerlink" title="开启BBR"></a>开启BBR</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> uname -r    <span class="comment"># 查看内核是刚刚安装的版本</span></span></span><br></pre></td></tr></table></figure><p>执行 <code>lsmod | grep bbr</code>，结果中如果没有 <code>tcp_bbr</code> 就先执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> modprobe tcp_bbr</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"tcp_bbr"</span> &gt;&gt; /etc/modules-load.d/modules.conf</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"net.core.default_qdisc=fq"</span> &gt;&gt; /etc/sysctl.conf</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"net.ipv4.tcp_congestion_control=bbr"</span> &gt;&gt; /etc/sysctl.conf</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sysctl -p</span></span><br></pre></td></tr></table></figure><p>执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sysctl net.ipv4.tcp_available_congestion_control</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sysctl net.ipv4.tcp_congestion_control</span></span><br></pre></td></tr></table></figure><p>结果如果都有bbr,则内核已开启bbr,</p><div style="display:none"><script src="http://s4.cnzz.com/stat.php?id=&web_id=" language="JavaScript"></script>script></div></body></html>