<html><head><title>Hype-v Linux vps在同一物理机上xshell无法ssh</title><meta name="keywords" content="linux"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link href="/css/main.css?v=3" rel="stylesheet" type="text/css"><script src="/js/util.js"></script><script>isMobile()?loadjscssfile("../css/mobile.css","css"):loadjscssfile("../css/desktop.css","css")</script><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"></head><body><h2 class="title">Hype-v Linux vps在同一物理机上xshell无法ssh</h2><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#下载Linux-Integration-Services"><span class="toc-text">下载Linux Integration Services</span></a></li></ol><a id="more"></a><p>在Hype-v安装完Linux虚拟机后,无法用物理机上的ssh登录管理Linux.虚拟机需要安装微软提供相关的驱动.</p><h3 id="下载Linux-Integration-Services"><a href="#下载Linux-Integration-Services" class="headerlink" title="下载Linux Integration Services"></a>下载Linux Integration Services</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">https://www.microsoft.com/en-us/download/details.aspx?id=51612</span><br><span class="line">将下载的ISO文件挂载到虚拟机</span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir -p /mnt/cdrom</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mount /dev/cdrom /mnt/cdrom</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /mnt/cdrom</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./install.sh</span></span><br><span class="line">进入相关的网卡文件设置固定ip即可</span><br></pre></td></tr></table></figure><p><strong>hype-v 导出虚拟机</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">以管理员身份运行powershell,输入如下命令,VMName为你创建虚拟机的名字</span><br><span class="line"><span class="variable">$VmName</span> = <span class="string">"CentOS7"</span></span><br><span class="line"><span class="variable">$Destination</span> = <span class="string">"F:\vm-export"</span></span><br><span class="line"> Stop-VM -Name <span class="variable">$VmName</span></span><br><span class="line"> Export-VM -Name <span class="variable">$VmName</span> -Path <span class="variable">$Dstination</span></span><br></pre></td></tr></table></figure><p><strong>导入到另一台物理机上的hype-v,复制虚拟机依赖的是$Destination目录下的vhdx格式文件。换一台物理机,开始虚拟机镜像的安装。</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">创建Internal vSwitch，通过PowerShell：</span><br><span class="line"><span class="variable">$HyperVVirtualSwitchName</span> = <span class="string">"ISInternalSwitch"</span></span><br><span class="line"> New-VMSwitch -Name <span class="variable">$HyperVVirtualSwitchName</span> -SwitchType Internal</span><br><span class="line"> Get-NetAdapter | where &#123; <span class="variable">$_</span>.Name <span class="nomarkup">-Match</span> <span class="variable">$HyperVVirtualSwitchName</span> &#125; | New-NetIPAddress -IPAddress <span class="string">"192.168.1.1"</span> -PrefixLength <span class="number">24</span></span><br><span class="line"> </span><br><span class="line">基于导出的CentOS7镜像和vSwitch，创建新的实例。键入PowerShell：</span><br><span class="line"><span class="variable">$VMName</span> = <span class="string">"CentOS7"</span></span><br><span class="line"><span class="variable">$HyperVVirtualSwitchName</span> = <span class="string">"ISInternalSwitch"</span></span><br><span class="line"><span class="variable">$VMPath</span> = <span class="string">"F:\vm-import\<span class="variable">$VMName</span>"</span></span><br><span class="line"><span class="variable">$VHDX</span> = <span class="string">"<span class="variable">$VMPath</span>\Virtual Hard Disks\CentOS7-TensorFlow10.vhdx"</span></span><br><span class="line"> New-VM -Name <span class="variable">$VMName</span> -SwitchName <span class="variable">$HyperVVirtualSwitchName</span> -Path <span class="variable">$VMPath</span> -VHDPath <span class="variable">$VHDX</span> -Generation <span class="number">1</span></span><br><span class="line"> Start-VM -Name <span class="variable">$VMName</span></span><br><span class="line"></span><br><span class="line">设置端口转发和开启防火墙。键入Windows批处理命令：</span><br><span class="line">netsh interface portproxy delete v4tov4 listenport=<span class="number">22</span></span><br><span class="line">netsh interface portproxy add v4tov4 listenport=<span class="number">22</span> connectport=<span class="number">22</span> connectaddress=<span class="number">192.168</span>.<span class="number">1.100</span></span><br><span class="line">netsh advfirewall firewall delete rule name=<span class="string">"CentOS_SSH"</span></span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">"CentOS_SSH"</span> protocol=TCP dir=<span class="keyword">in</span> localport=<span class="number">22</span> action=allow</span><br></pre></td></tr></table></figure><div style="display:none"><script src="http://s4.cnzz.com/stat.php?id=&web_id=" language="JavaScript"></script>script></div></body></html>