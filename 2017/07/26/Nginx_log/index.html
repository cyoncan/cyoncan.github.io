<html><head><title>Nginx日志</title><meta name="keywords" content="linux"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link href="/css/main.css?v=3" rel="stylesheet" type="text/css"><script src="/js/util.js"></script><script>isMobile()?loadjscssfile("../css/mobile.css","css"):loadjscssfile("../css/desktop.css","css")</script><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"></head><body><h2 class="title">Nginx日志</h2><ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#Ⅰ-日志切割"><span class="toc-text">Ⅰ.日志切割</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Ⅱ-日志日常分析"><span class="toc-text">Ⅱ.日志日常分析</span></a></li></ol><a id="more"></a><h5 id="Ⅰ-日志切割"><a href="#Ⅰ-日志切割" class="headerlink" title="Ⅰ.日志切割"></a>Ⅰ.日志切割</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">D=$(data +%Y%M%D)</span><br><span class="line">mv /usr/local/nginx/logs/access.log $&#123;D&#125;.log</span><br><span class="line">kill -USR1 $(cat /usr/local/nginx/nginx.pid)</span><br></pre></td></tr></table></figure><h5 id="Ⅱ-日志日常分析"><a href="#Ⅱ-日志日常分析" class="headerlink" title="Ⅱ.日志日常分析"></a>Ⅱ.日志日常分析</h5><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">log_formart</span> main <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" <span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" "<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br></pre></td></tr></table></figure><p>1.访问次数最多的前十IP</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> awk <span class="string">'&#123;print $1&#125;'</span> access.log | sort | uniq -c | sort -nr -k1 | head -n 10   <span class="comment">#uniq去重之前必须先排序,因为不排序的话,uniq无法去重不连续出现的数,sort加不加参数无所谓,只要排序能将一样的IP集中一起即可</span></span></span><br></pre></td></tr></table></figure><p>2.请求总数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wc -l access.log | awk <span class="string">'&#123;print $1&#125;'</span></span></span><br></pre></td></tr></table></figure><p>3.独立IP数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> awk <span class="string">'&#123;print $1&#125;'</span> access.log | sort | uniq -c | wc -l</span></span><br></pre></td></tr></table></figure><p>4.</p><div style="display:none"><script src="http://s4.cnzz.com/stat.php?id=&web_id=" language="JavaScript"></script>script></div></body></html>