<html><head><title>PHP环境配置</title><meta name="keywords" content="linux"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link href="/css/main.css?v=3" rel="stylesheet" type="text/css"><script src="/js/util.js"></script><script>isMobile()?loadjscssfile("../css/mobile.css","css"):loadjscssfile("../css/desktop.css","css")</script><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"></head><body><h2 class="title">PHP环境配置</h2><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP"><span class="toc-text">PHP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-编译安装"><span class="toc-text">1.编译安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-php-fpm服务启动管理"><span class="toc-text">2.php-fpm服务启动管理</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#tip-php-fpm-service管理使用脚本-根据实情修改对应目录"><span class="toc-text">tip: php-fpm service管理使用脚本,根据实情修改对应目录</span></a></li></ol></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Nginx配置php-fpm"><span class="toc-text">3.Nginx配置php-fpm</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1修改nginx-conf-根据里面默认的注释例子修改"><span class="toc-text">3.1修改nginx.conf,根据里面默认的注释例子修改</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-在conf-vhost-目录下编写配置每一个站点的conf文件-可以拷贝Nginx里面的例子进行修改"><span class="toc-text">3.2.在conf/vhost/目录下编写配置每一个站点的conf文件,可以拷贝Nginx里面的例子进行修改.</span></a></li></ol></li><a id="more"></a><h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><h3 id="1-编译安装"><a href="#1-编译安装" class="headerlink" title="1.编译安装"></a>1.编译安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install gcc automake autoconf libtool make glibc</span><br><span class="line">$ <span class="built_in">cd</span> /data/src</span><br><span class="line">$ wget -c http://cn2.php.net/distributions/php-5.5.38.tar.gz</span><br><span class="line">$ tar -zxvf php-5.5.38.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> php-5.5.38</span><br><span class="line">$ ./configure --prefix=/data/<span class="built_in">local</span>/php --<span class="built_in">enable</span>-fpm</span><br><span class="line">(如果这里没有加--<span class="built_in">enable</span>-fpm, php5.3及以上的内置了php-fpm 可以重新编译加上参数。或者yum install php-fpm,</span><br><span class="line">以下供参数参考 configure过程中有提示参数软件未安装的就安装后再configure,或者去除参数:</span><br><span class="line"></span><br><span class="line">./configure --prefix=/data/<span class="built_in">local</span>/php --with-config-file-path=/data/<span class="built_in">local</span>/php/etc --with-mysql=/data/<span class="built_in">local</span>/mysql --with-mysqli=/data/<span class="built_in">local</span>/mysql/bin/mysql_config --with-pdo-mysql=/data/<span class="built_in">local</span>/mysql --with-pcre-dir=/data/<span class="built_in">local</span>/pcre/bin/pcre-config --<span class="built_in">enable</span>-bcmath --<span class="built_in">enable</span>-exif --<span class="built_in">enable</span>-fpm --<span class="built_in">enable</span>-ftp --<span class="built_in">enable</span>-fastCGI --<span class="built_in">enable</span>-force-CGI-redirect --<span class="built_in">enable</span>-gd-native-ttf --<span class="built_in">enable</span>-inline-optimization --<span class="built_in">enable</span>-mbstring --<span class="built_in">enable</span>-opcache --<span class="built_in">enable</span>-pcntl --<span class="built_in">enable</span>-pdo_mysql --<span class="built_in">enable</span>-soap --<span class="built_in">enable</span>-shmop --<span class="built_in">enable</span>-sockets --<span class="built_in">enable</span>-sysvsem --<span class="built_in">enable</span>-sysvmsg --<span class="built_in">enable</span>-sysvshm --<span class="built_in">enable</span>-zip --<span class="built_in">enable</span>-zend-multibyte --with-bz2 --with-curl --with-curlwrappers --with-freetype-dir --with-gd --with-gdbm --with-gmp --with-gettext --with-jpeg-dir --with-libxml-dir --with-libdir --with-mhash --with-mcrypt --with-openssl --with-png-dir --with-pear --with-xsl --with-zlib-dir </span><br><span class="line"></span><br><span class="line">附加参数参考 http://t.cn/Ri0WWcq)如果有httpd，可以加上 --with-apxs2=/data/<span class="built_in">local</span>/httpd/bin/apxs这段参数，避免以后要使用httpd再重新编译php。</span><br><span class="line">$ make <span class="built_in">test</span></span><br><span class="line">$ make install</span><br><span class="line">$ cp php.ini-development /data/<span class="built_in">local</span>/php/etc/php.ini   (去目录将cp过去的文件重命 php.ini)</span><br><span class="line">$ vim php.ini</span><br><span class="line">  date.timezone = PRC   (或者Asia/Shanghai)</span><br><span class="line">  magic_quotes_gpc = On   (防止SQL注入)</span><br><span class="line">$ cp /data/<span class="built_in">local</span>/php/etc/php-fpm.default.conf php-fpm.conf</span><br><span class="line">$ /data/<span class="built_in">local</span>/php/sbin/php-fpm -R  (启动fpm)</span><br><span class="line">  <span class="built_in">kill</span> -INT `cat <span class="variable">$PATH</span>:php-fpm.pid`   关闭(cat后面输入php-fpm.pid路径)</span><br><span class="line">  <span class="built_in">kill</span> -USR2 `cat <span class="variable">$PATH</span>:php-fpm.pid`  重启</span><br><span class="line">$ ps -ef | grep php-fpm 或者 lsof -i :9000</span><br><span class="line">设置php-fpm开机启动：vim /etc/<span class="built_in">local</span> ,最后一行加入 /data/<span class="built_in">local</span>/php/sbin/php-fpm 即可</span><br></pre></td></tr></table></figure><h3 id="2-php-fpm服务启动管理"><a href="#2-php-fpm服务启动管理" class="headerlink" title="2.php-fpm服务启动管理"></a>2.php-fpm服务启动管理</h3><h6 id="tip-php-fpm-service管理使用脚本-根据实情修改对应目录"><a href="#tip-php-fpm-service管理使用脚本-根据实情修改对应目录" class="headerlink" title="tip: php-fpm service管理使用脚本,根据实情修改对应目录"></a>tip: php-fpm service管理使用脚本,根据实情修改对应目录</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Startup script <span class="keyword">for</span> the PHP-FPM server.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chkconfig: 345 85 15</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> description: PHP is an HTML-embedded scripting language</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> processname: php-fpm</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> config: /usr/<span class="built_in">local</span>/php/etc/php.ini</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> Source <span class="keyword">function</span> library.</span></span><br><span class="line">. /etc/rc.d/init.d/functions</span><br><span class="line"> </span><br><span class="line">PHP_PATH=/data/local</span><br><span class="line">DESC="php-fpm daemon"</span><br><span class="line">NAME=php-fpm</span><br><span class="line">DAEMON=$PHP_PATH/php/sbin/$NAME</span><br><span class="line">CONFIGFILE=$PHP_PATH/php/etc/php-fpm.conf</span><br><span class="line">PIDFILE=$PHP_PATH/php/var/run/$NAME.pid</span><br><span class="line">SCRIPTNAME=/etc/init.d/$NAME</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> Gracefully <span class="built_in">exit</span> <span class="keyword">if</span> the package has been removed.</span></span><br><span class="line">test -x $DAEMON || exit 0</span><br><span class="line"> </span><br><span class="line">rh_start() &#123;</span><br><span class="line"><span class="meta">  $</span><span class="bash">DAEMON -y <span class="variable">$CONFIGFILE</span> || <span class="built_in">echo</span> -n <span class="string">" already running"</span></span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">rh_stop() &#123;</span><br><span class="line">  kill -QUIT `cat $PIDFILE` || echo -n " not running"</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">rh_reload() &#123;</span><br><span class="line">  kill -HUP `cat $PIDFILE` || echo -n " can't reload"</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">case "$1" in</span><br><span class="line">  start)</span><br><span class="line">        echo -n "Starting $DESC: $NAME"</span><br><span class="line">        rh_start</span><br><span class="line">        echo "."</span><br><span class="line">        ;;</span><br><span class="line">  stop)</span><br><span class="line">        echo -n "Stopping $DESC: $NAME"</span><br><span class="line">        rh_stop</span><br><span class="line">        echo "."</span><br><span class="line">        ;;</span><br><span class="line">  reload)</span><br><span class="line">        echo -n "Reloading $DESC configuration..."</span><br><span class="line">        rh_reload</span><br><span class="line">        echo "reloaded."</span><br><span class="line">  ;;</span><br><span class="line">  restart)</span><br><span class="line">        echo -n "Restarting $DESC: $NAME"</span><br><span class="line">        rh_stop</span><br><span class="line">        sleep 1</span><br><span class="line">        rh_start</span><br><span class="line">        echo "."</span><br><span class="line">        ;;</span><br><span class="line">  *)</span><br><span class="line">         echo "Usage: $SCRIPTNAME &#123;start|stop|status|restart|reload&#125;" &gt;&amp;2</span><br><span class="line">         exit 3</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure><h2 id="3-Nginx配置php-fpm"><a href="#3-Nginx配置php-fpm" class="headerlink" title="3.Nginx配置php-fpm"></a>3.Nginx配置php-fpm</h2><h5 id="3-1修改nginx-conf-根据里面默认的注释例子修改"><a href="#3-1修改nginx-conf-根据里面默认的注释例子修改" class="headerlink" title="3.1修改nginx.conf,根据里面默认的注释例子修改"></a>3.1修改nginx.conf,根据里面默认的注释例子修改</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ vim /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">========================================================================================================</span><br><span class="line">    <span class="comment">#HTTP server</span></span><br><span class="line">    server&#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        <span class="built_in">return</span> 444;</span><br><span class="line">        <span class="comment">#server_name localhost;</span></span><br><span class="line">        charset utf-8;</span><br><span class="line">        </span><br><span class="line">        location / &#123;</span><br><span class="line">          root html;</span><br><span class="line">          index index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">    root           html;</span><br><span class="line">    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    fastcgi_index  index.php;</span><br><span class="line">    fastcgi_param  SCRIPT_FILENAME  <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">    include        fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$</span><br><span class="line">        &#123;</span><br><span class="line">                expires 30d;</span><br><span class="line">        &#125;</span><br><span class="line">        location ~ .*\.(js|css)?$</span><br><span class="line">        &#123;</span><br><span class="line">                expires 1h;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    inculude vhost/*.conf;</span><br><span class="line">========================================================================================================</span><br></pre></td></tr></table></figure><h5 id="3-2-在conf-vhost-目录下编写配置每一个站点的conf文件-可以拷贝Nginx里面的例子进行修改"><a href="#3-2-在conf-vhost-目录下编写配置每一个站点的conf文件-可以拷贝Nginx里面的例子进行修改" class="headerlink" title="3.2.在conf/vhost/目录下编写配置每一个站点的conf文件,可以拷贝Nginx里面的例子进行修改."></a>3.2.在conf/vhost/目录下编写配置每一个站点的conf文件,可以拷贝Nginx里面的例子进行修改.</h5><div style="display:none"><script src="http://s4.cnzz.com/stat.php?id=&web_id=" language="JavaScript"></script>script></div></body></html>