---
title: DNS服务器搭建
date: 2017-06-7  17:33:16
categories:
- Linux
tags:
- dns
---

<!-- more -->

**需求：公司地址迁移，原来内部测试服务器用的是某百兆企业路由器做的DNS重定向。新地址用的是五百兆宽带，弃用了原来的路由器，换了新的千兆，但是没有DNS重定向功能，于是就在测试服务器本身搭建DNS服务，提供内网自定义域名解析。**

系统： centos6.8

ip地址：192.168.1.100

dns软件：bind

域名：test88.tt

### 1.安装

```shell
$ yum install bind
$ yum install bind-chroot
```

### 2.修改配置文件 

```shell
$ cp /etc/named.conf /etc/named.conf.bak   #先备份原配置文件
$ vim /etc/named.conf
//
// named.conf
//
// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
// server as a caching only nameserver (as a localhost DNS resolver only).
//
// See /usr/share/doc/bind*/sample/ for example named configuration files.
//

options {
	listen-on port 53 { any; };   //53为dns监听端口，any代表监听所以主机。
	listen-on-v6 port 53 { ::1; };   //属于ipv6
	directory 	"/var/named";   
	dump-file 	"/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
	allow-query     { any; };   //对DNS服务器提出查询请求。any代表任何人
	recursion yes;

	dnssec-enable yes;
	dnssec-validation yes;

	/* Path to ISC DLV key */
	bindkeys-file "/etc/named.iscdlv.key";

	managed-keys-directory "/var/named/dynamic";
};

logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

zone "." IN {
	type hint;
	file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";
```

### 3.自定义域名解析配置

```shell
$ vim /etc/named.rfc1912.zones   //添加域
//正向域
zone "test88.tt" IN {
	type master;
	file "test88.tt.zone";
	allow-update { none; };
};
//反向域
zone "1.168.192.in-addr.arpa" IN {
	type master;
	file "1.168.192.arpa";
	allow-update { none; };
};
```

### 4.自定义test88.tt.zone和1.168.192.arpa文件

test88.tt.zone

```shell
$ cd /var/named/
$ cp -a named.localhost test88.tt.zone
$ vim test88.tt.zone
$TTL 86400
@	IN SOA		ns.test88.tt. rname.invalid. (
					0	; serial
					1D	; refresh
					1H	; retry
					1W	; expire
					3H )	; minimum
@	IN	NS	ns.test88.tt.
ns	IN	A	192.168.2.100
www	IN	A	192.168.2.100
mail	IN  A	192.168.2.115
zentao	IN	A	192.168.2.100
wiki	IN	A	192.168.2.100
```

1.168.192.arpa

```shell
$TTL 86400
@	IN SOA	test88.tt. rname.invalid. (
					0	; serial
					1D	; refresh
					1H	; retry
					1W	; expire
					3H )	; minimum
	IN 	NS	@
	IN	A	127.0.0.1
100	IN	PTR	www.test88.tt.
100	IN	PTR	mail.test88.tt.
100	IN	PTR	zentao.test88.tt.
100	IN	PTR	wiki.test88.tt.
```

### 5.修改DNS配置

```shell
$ vim /etc/resolv.conf
# Generated by NetworkManager
nameserver 192.168.2.100
nameserver 192.168.2.1
$ service named start
```

### 6.修改客户端机器的DNS为192.168.2.100

*服务器防火墙开放53端口udp和tcp均要，关闭selinux。*

